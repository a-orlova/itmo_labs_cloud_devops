### Шаг 1: "Плохой" Docker Compose файл

```yaml
version: "3"
services:
  app:
    image: my-app:latest
    build:
      context: .
    volumes:
      - .:/app
    ports:
      - "80:80"
    environment:
      - DEBUG=true
      - APP_SECRET=supersecretkey
  db:
    image: mysql:5.7
    environment:
      - MYSQL_ROOT_PASSWORD=root
    ports:
      - "3306:3306"
    networks:
      - default
```

---

### Шаг 2: "Хороший" Docker Compose файл

```yaml
version: "3.9"
services:
  app:
    image: my-app:1.0.0
    build:
      context: .
    volumes:
      - /app/data:/app/data:ro
    ports:
      - "127.0.0.1:8080:8080"
    environment:
      DEBUG: "false"
      APP_SECRET: "${APP_SECRET}"
    networks:
      - app_net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    depends_on:
      - db
    restart: always

  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
    volumes:
      - db_data:/var/lib/mysql
    ports:
      - "127.0.0.1:3306:3306"
    networks:
      - db_net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    restart: always

volumes:
  db_data:

networks:
  app_net:
    driver: bridge
  db_net:
    driver: bridge
```

---

### Шаг 3: README с описанием плохих практик и исправлений

#### Плохие практики в "плохом" файле:

1. **Не указана версия Compose файла**
   - **Почему плохо**: Это может привести к использованию устаревших функций или неожиданному поведению.
   - **Исправление**: Указана версия `3.9`, которая поддерживает все современные функции Docker Compose.

2. **Монтирование текущего каталога в контейнер**
   - **Почему плохо**: Это позволяет контейнеру получить доступ ко всем файлам проекта, включая ненужные или конфиденциальные.
   - **Исправление**: Теперь монтируется только строго необходимая директория `/app/data` с флагом `ro` (read-only).

3. **Привязка стандартного порта 80**
   - **Почему плохо**: Использование стандартного порта 80 может привести к конфликтам с другими сервисами на том же хосте.
   - **Исправление**: Привязка к пользовательскому порту `8080` и ограничение доступа через `127.0.0.1`.

4. **Открытые порты для всех**
   - **Почему плохо**: Контейнеры доступны извне без ограничений, что увеличивает риск несанкционированного доступа.
   - **Исправление**: Ограничен доступ через `127.0.0.1`, что позволяет подключаться только с локального хоста.

5. **Хранение конфиденциальных данных в файле `docker-compose.yml`**
   - **Почему плохо**: Это приводит к утечке данных через системы контроля версий.
   - **Исправление**: Использование переменных окружения через `${}` и их настройка через `.env` файл.

6. **Отсутствие именованных томов**
   - **Почему плохо**: Если контейнер удален, данные тоже теряются, так как они не сохраняются между запусками.
   - **Исправление**: Добавлен именованный том `db_data` для сохранения данных базы данных.

7. **Все контейнеры находятся в одной сети**
   - **Почему плохо**: Контейнеры могут взаимодействовать друг с другом без необходимости, увеличивая риск атак.
   - **Исправление**: Контейнеры разделены на разные сети (`app_net` и `db_net`), обеспечивая изоляцию.

8. **Отсутствие настроек логирования**
   - **Почему плохо**: Логи могут занимать слишком много места на диске.
   - **Исправление**: Добавлены настройки логирования с ротацией (`max-size` и `max-file`).

9. **Отсутствие политики перезапуска**
   - **Почему плохо**: Если контейнеры упадут, они не перезапустятся автоматически.
   - **Исправление**: Добавлена политика `restart: always`.

10. **Использование тега `latest`**
    - **Почему плохо**: Тег `latest` может привести к неожиданному обновлению образа и нарушению работы.
    - **Исправление**: Используется фиксированный тег образа (`my-app:1.0.0`).

---

### Шаг 4: Изоляция контейнеров

В "хорошем" файле контейнеры изолированы через использование отдельных сетей:
- **`app_net`** — для приложения.
- **`db_net`** — для базы данных.

Это достигается добавлением секции `networks` и явным указанием сети для каждого сервиса.

#### Принцип изоляции

Каждая сеть Docker Compose создает отдельное виртуальное сетевое пространство. Контейнеры в одной сети могут взаимодействовать друг с другом, а между сетями — нет, если не настроено иначе. Такой подход минимизирует риски случайных или злонамеренных взаимодействий между контейнерами.
